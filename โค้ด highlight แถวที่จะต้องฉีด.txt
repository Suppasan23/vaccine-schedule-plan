// แทนที่ const rows = intervals.map(...) block ด้วยทั้งหมดนี้



// Step 1: Calculate all dueDates
const vaccineSchedule = intervals.map((interval) => {
  const dueDate = new Date(birthDate);
  dueDate.setMonth(dueDate.getMonth() + interval.months);

  // Get second Wednesday logic
  function getSecondWednesday(year, month) {
    const firstDay = new Date(year, month, 1);
    const firstWednesdayOffset = (3 - firstDay.getDay() + 7) % 7;
    const secondWednesdayDate = 1 + firstWednesdayOffset + 7;
    return new Date(year, month, secondWednesdayDate);
  }

  let scheduledDate = getSecondWednesday(dueDate.getFullYear(), dueDate.getMonth());
  if (scheduledDate < dueDate) {
    scheduledDate = getSecondWednesday(dueDate.getFullYear(), dueDate.getMonth() + 1);
  }

  return { ...interval, dueDate, scheduledDate };
});

// Step 2: Find the next upcoming dueDate
const nextVaccine = vaccineSchedule.find(({ dueDate }) => dueDate >= today);

// Step 3: Generate HTML rows and highlight only the next one
const rows = vaccineSchedule
  .map(({ label, vaccine, dueDate, scheduledDate }) => {
    const highlight = nextVaccine && dueDate.getTime() === nextVaccine.dueDate.getTime();
    return `
      <tr class="${highlight ? "highlight-color" : ""}">
        <td>${label}</td>
        <td>${vaccine}</td>
        <td>${formatDateWithDay(dueDate)}</td>
        <td>${formatDateWithDay(scheduledDate)}</td>
      </tr>
    `;
  })
  .join("");